{% extends 'base.html' %}

{% block title %}0&X. | Shop{% endblock %}

{% load static %}

{% block content %}
    <div class="blockquote text-right">
        <div class="col-12">
            <h6 class="mx-5 px-5 pt-5 text-left">"Discover our range of carefully and lovingly crafted Soy-Wax candles. Embellished with rich aromatherpy essential oils, expand in it's treasured essence. Each candle is created using the concept of opposites. Without each other, we cannot know either. We celebrate this simple yet highly evolved and powerful statetment. Individually perfect or together we view your custom as an investment into yourself. This is why we pour as much love and light into each creation as we can. This is great celebration in your personal investment."</h6>
            <footer class="blockquote-footer mx-5 mt-5 px-5 pt-5">0&X. - A statement of our heart.</footer>
        </div>
    </div>
    <div class="container-fluid product-display m-0">
        <div class="row">
            {% for product in products %}
                <div class="col-12 col-md-5 mx-auto">
                    <div class="card m-2 p-2">
                        <img src="{{MEDIA_URL}}{{product.image}}" class="card-img-top" alt="image of candles label">
                        <div class="card-body">
                            <h4 class="card-title">{{product.name}}</h4>
                            <p class="card-text">{{product.description}}</p>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">Â£{{ product.price }}</h5>
                            <a href="{% url 'displayProduct' product.id %}" class="card-link">
                                <button style="background-color:#6772E5;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em"> 
                                    Discover more
                                </button>
                            </a>
                            <button class="buy-button snipcart-add-item"
                                data-item-id="{{ product.id }}"
                                data-item-price="{{ product.price }}"
                                data-item-url= "/shop/"
                                data-item-description="{{ product.description }}"
                                data-item-image="{{ MEDIA_URL }}{{ product.image }}"
                                data-item-name="{{ product.name }}" console.log('data-item-url') style="background-color:#6772E5;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em">
                                Add to cart
                            </button>
                            <button style="background-color:#6772E5;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em"
                                id="checkout-button-{{product.stripe_id}}" role="link">Quick Buy
                            </button>
                            <div id="error-message"></div>
                            <!-- Create a button that your customers click to complete their purchase. Customize the styling to suit your branding. -->

                            <script>
                            (function() {
                            var stripe = Stripe('pk_test_Y2i99BqaB4dkr4aoMQHwUpAw00qD1gBOEw');

                            var checkoutButton = document.getElementById('checkout-button-{{product.stripe_id}}');
                            checkoutButton.addEventListener('click', function () {
                                // When the customer clicks on the button, redirect
                                // them to Checkout.
                                stripe.redirectToCheckout({
                                lineItems: [{price: '{{product.stripe_id}}', quantity: 1}],
                                mode: 'payment',
                                // Do not rely on the redirect to the successUrl for fulfilling
                                // purchases, customers may not always reach the success_url after
                                // a successful payment.
                                // Instead use one of the strategies described in
                                // https://stripe.com/docs/payments/checkout/fulfillment
                                successUrl: 'http://127.0.1:8000/payment/success/',
                                cancelUrl: 'http://127.0.1:8000/payment/cancel/',
                                billingAddressCollection: 'required',
                                shippingAddressCollection: {allowedCountries: ['GB', 'US', 'CA'],}
                                })
                                .then(function (result) {
                                if (result.error) {
                                    // If `redirectToCheckout` fails due to a browser or network
                                    // error, display the localized error message to your customer.
                                    var displayError = document.getElementById('error-message');
                                    displayError.textContent = result.error.message;
                                }
                                });
                            });
                            })();
                            </script>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <!--Candle made features -->
    <div class="blockquote align-middle clearfix">
        <span class="float-left">
            <span class="shop-link-arrow">.<</span><span class="shop-link-text-2"><a href="{% url 'index' %}">Home</a></span>
        </span>
        <span class="float-right">
            <span class="shop-link-text-2"><a href="{% url 'displayShop' %}">About&Contact </a></span><span class="shop-link-arrow">>.</span>
        </span>
    </div>
{% endblock %}